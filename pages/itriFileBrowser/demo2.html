<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--common css-->

    <link href="css/reset.css" rel="stylesheet" type="text/css" />
    <link href="css/itriFileBrowser.css" rel="stylesheet" type="text/css" />
    <link href="css/blue/style.css" rel="stylesheet" type="text/css" />
    <link href="css/ui-lightness/jquery-ui-1.8.19.custom.css" rel="stylesheet" type="text/css" />
    <!--common js-->
    <script src="js/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="js/jquery.tablesorter.js" type="text/javascript"></script>
    <script src="js/jquery-ui-1.8.19.custom.min.js" type="text/javascript"></script>
   <script src="js/jquery.itriCSSJsonParser.js" type="text/javascript"></script>
   <script src="js/jquery.itriFileBrowser2.js" type="text/javascript"></script>


    
    <script type="text/javascript">

        $(function()
        {
        
        // add parser through the tablesorter addParser method 
            $.tablesorter.addParser({ 
                // set a unique id 
                id: 'mbsorter', 
                is: function(s) { 
                    // return false so this parser is not auto detected 
                    return false; 
                }, 
                format: function(s) { 
                    var num = parseFloat(s);
                    if(isNaN(num))
                        num = 0;
                        
                    return num; 
                }, 
                // set type, either numeric or text 
                type: 'numeric' 
            });
            
        //January 6, 1978 9:12 AM or Jan. 6, 2001 9:12 AM
        var monthNames = {};
        monthNames["Jan"] = "01";
        monthNames["Feb"] = "02";
        monthNames["Mar"] = "03";
        monthNames["Apr"] = "04";
        monthNames["May"] = "05";
        monthNames["Jun"] = "06";
        monthNames["Jul"] = "07";
        monthNames["Aug"] = "08";
        monthNames["Sep"] = "09";
        monthNames["Oct"] = "10";
        monthNames["Nov"] = "11";
        monthNames["Dec"] = "12";
        
        $.tablesorter.addParser({
          id: 'monthDayYear',
          is: function(s) {
              return false;
          },
          format: function(s) {debugger;
              var date = s.match(/^(\w{3})[ ](\d{1,2}),[ ](\d{4})$/);
              var m = monthNames[date[1]];
              var d = String(date[2]);
              if (d.length == 1) {d = "0" + d;}
              var y = date[3];
              return '' + y + m + d;
          },
          type: 'numeric'
        });
        
        function loadFileData(){
        
            $.itriCSSJsonParser({
                url:'js/response.json',
                type: 'fileBrowser',
                rootId: "fileList2",
                success: function(elements, rawData){
                   $("#wrapDiv").append(elements);
                   var $fileBrowser = $("#fileList2")
                   .tablesorter({
                        sortList: [[0,0],[1,0]],
                        headers: { 
                            "1": { 
                                sorter:'mbsorter' 
                            }
                        } 
                    })
                    .itriFileBrowser({
                            rawData: rawData,
                            onDrop: function(sel, target, selData, targetData){
                                      var selStr =" [ "; 
                                      sel.each(function(){
                                        selStr = selStr +$(this).find(".name").html() + ", ";
                                      })
                                      selStr = selStr + " ] ";
                                      _L("drop" + selStr + " to "+ target.find(".name").html())
                                       
                                      sel.empty().remove();
                            },
                            onUpdateSel: function(sel, selData, isAdd){
                                  $("#selNum").html(selData.length);
                                  var $infoObj = $("#info");
                                  if(selData.length!=0)
                                  {
                                      $infoObj.empty();
                                      $.each(selData, function(i, t){
                                        var dataDivStr = 
                                        "<div class='item'>"+
                                        "<div> id:"+t.id+"</div>"+
                                        "<div> name:"+t.name+"</div>"+
                                        "<div> size:"+t.size+"</div>"+
                                        "<div> type:"+t.type+"</div>"+
                                        "<\div>";
                                        //var $dataDiv = $(dataDivStr);
                                        $infoObj.append(dataDivStr);
                                      });
                       
                                  }
                            }
                    
                    });
                    
                  $fileBrowser.getSelections();
                    
                }
            });
            
       } 
       
       loadFileData();
             
       $('#testBtn').click(function(){
           $("#wrapDiv").empty();
           loadFileData();
        });

        
        /*
            $("#fileList").tablesorter({
                        //sortList: [[0,0],[1,0]],
                        headers: { 
                            "1": { 
                                sorter:'mbsorter' 
                            }
                        } 
                    }).itriFileBrowser({
                            onDrop: function(selections, target){
                                      var selStr =" [ "; 
                                      selections.each(function(){
                                        selStr = selStr +$(this).find(".name").html() + ", ";
                                      })
                                      selStr = selStr + " ] ";
                                      _L("drop" + selStr + " to "+ target.find(".name").html())
                                       
                                      selections.empty().remove();
                                    }
                    
                    });
                */    
                    
        });
  
    </script> 

    <style>
    body{width:100%; height:100%; }
    #debugDiv{width:50%; margin: 0 auto; height:100px; border: solid 1px #000; margin-top:10px; overflow: auto; }
    #debugDiv div{background: #c0c0c0; margin: 0 auto; border: solid 1px #000; margin-top:3px;}
    #info{position: absolute;}
    #info .item{border: solid 1px #000;}
   
    </style>
</head>
<body tabindex="0">
<button id="testBtn">refresh</button>
<div>select number: <span id="selNum">0</span></div>
<div>information: <div id="info"></div></div>

<div id='wrapDiv' class='wrapDiv'>


</div>
<div id='debugDiv'>Log:</div>

</body>
</html>
