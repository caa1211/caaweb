/**
 * jqPlot
 * Pure JavaScript plotting plugin using jQuery
 *
 * Version: 1.0.3r1117
 *
 * Copyright (c) 2009-2011 Chris Leonello
 * jqPlot is currently available for use in all personal or commercial projects 
 * under both the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL 
 * version 2.0 (http://www.gnu.org/licenses/gpl-2.0.html) licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly. 
 *
 * Although not required, the author would appreciate an email letting him 
 * know of any substantial use of jqPlot.  You can reach the author at: 
 * chris at jqplot dot com or see http://www.jqplot.com/info.php .
 *
 * If you are feeling kind and generous, consider supporting the project by
 * making a donation at: http://www.jqplot.com/donate.php .
 *
 * sprintf functions contained in jqplot.sprintf.js by Ash Searle:
 *
 *     version 2007.04.27
 *     author Ash Searle
 *     http://hexmen.com/blog/2007/03/printf-sprintf/
 *     http://hexmen.com/js/sprintf.js
 *     The author (Ash Searle) has placed this code in the public domain:
 *     "This code is unrestricted: you are free to use it however you like."
 *
 * included jsDate library by Chris Leonello:
 *
 * Copyright (c) 2010-2011 Chris Leonello
 *
 * jsDate is currently available for use in all personal or commercial projects 
 * under both the MIT and GPL version 2.0 licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly.
 *
 * jsDate borrows many concepts and ideas from the Date Instance 
 * Methods by Ken Snyder along with some parts of Ken's actual code.
 * 
 * Ken's origianl Date Instance Methods and copyright notice:
 * 
 * Ken Snyder (ken d snyder at gmail dot com)
 * 2008-09-10
 * version 2.0.2 (http://kendsnyder.com/sandbox/date/)     
 * Creative Commons Attribution License 3.0 (http://creativecommons.org/licenses/by/3.0/)
 *
 * jqplotToImage function based on Larry Siden's export-jqplot-to-png.js.
 * Larry has generously given permission to adapt his code for inclusion
 * into jqPlot.
 *
 * Larry's original code can be found here:
 *
 * https://github.com/lsiden/export-jqplot-to-png
 * 
 * 
 */
(function($){$.jqplot.DateAxisRenderer=function(){$.jqplot.LinearAxisRenderer.call(this);this.date=new $.jsDate()};$.jqplot.DateAxisRenderer.prototype=new $.jqplot.LinearAxisRenderer();$.jqplot.DateAxisRenderer.prototype.constructor=$.jqplot.DateAxisRenderer;$.jqplot.DateTickFormatter=function(format,val){if(!format){format='%Y/%m/%d'}return $.jsDate.strftime(val,format)};$.jqplot.DateAxisRenderer.prototype.init=function(options){this.tickOptions.formatter=$.jqplot.DateTickFormatter;this.daTickInterval=null;this._daTickInterval=null;$.extend(true,this,options);var db=this._dataBounds,stats,sum,s,d,pd,sd,intv;for(var i=0;i<this._series.length;i++){stats={intervals:[],frequencies:{},sortedIntervals:[],min:null,max:null,mean:null};sum=0;s=this._series[i];d=s.data;pd=s._plotData;sd=s._stackData;intv=0;for(var j=0;j<d.length;j++){if(this.name=='xaxis'||this.name=='x2axis'){d[j][0]=new $.jsDate(d[j][0]).getTime();pd[j][0]=new $.jsDate(d[j][0]).getTime();sd[j][0]=new $.jsDate(d[j][0]).getTime();if((d[j][0]!=null&&d[j][0]<db.min)||db.min==null){db.min=d[j][0]}if((d[j][0]!=null&&d[j][0]>db.max)||db.max==null){db.max=d[j][0]}if(j>0){intv=Math.abs(d[j][0]-d[j-1][0]);stats.intervals.push(intv);if(stats.frequencies.hasOwnProperty(intv)){stats.frequencies[intv]+=1}else{stats.frequencies[intv]=1}}sum+=intv}else{d[j][1]=new $.jsDate(d[j][1]).getTime();pd[j][1]=new $.jsDate(d[j][1]).getTime();sd[j][1]=new $.jsDate(d[j][1]).getTime();if((d[j][1]!=null&&d[j][1]<db.min)||db.min==null){db.min=d[j][1]}if((d[j][1]!=null&&d[j][1]>db.max)||db.max==null){db.max=d[j][1]}if(j>0){intv=Math.abs(d[j][1]-d[j-1][1]);stats.intervals.push(intv);if(stats.frequencies.hasOwnProperty(intv)){stats.frequencies[intv]+=1}else{stats.frequencies[intv]=1}}}sum+=intv}if(s.renderer.bands){if(s.renderer.bands.hiData.length){var bd=s.renderer.bands.hiData;for(var j=0,l=bd.length;j<l;j++){if(this.name==='xaxis'||this.name==='x2axis'){bd[j][0]=new $.jsDate(bd[j][0]).getTime();if((bd[j][0]!=null&&bd[j][0]>db.max)||db.max==null){db.max=bd[j][0]}}else{bd[j][1]=new $.jsDate(bd[j][1]).getTime();if((bd[j][1]!=null&&bd[j][1]>db.max)||db.max==null){db.max=bd[j][1]}}}}if(s.renderer.bands.lowData.length){var bd=s.renderer.bands.lowData;for(var j=0,l=bd.length;j<l;j++){if(this.name==='xaxis'||this.name==='x2axis'){bd[j][0]=new $.jsDate(bd[j][0]).getTime();if((bd[j][0]!=null&&bd[j][0]<db.min)||db.min==null){db.min=bd[j][0]}}else{bd[j][1]=new $.jsDate(bd[j][1]).getTime();if((bd[j][1]!=null&&bd[j][1]<db.min)||db.min==null){db.min=bd[j][1]}}}}}var tempf=0,tempn=0;for(var n in stats.frequencies){stats.sortedIntervals.push({interval:n,frequency:stats.frequencies[n]})}stats.sortedIntervals.sort(function(a,b){return b.frequency-a.frequency});stats.min=$.jqplot.arrayMin(stats.intervals);stats.max=$.jqplot.arrayMax(stats.intervals);stats.mean=sum/d.length;this._intervalStats.push(stats);stats=sum=s=d=pd=sd=null}db=null};$.jqplot.DateAxisRenderer.prototype.reset=function(){this.min=this._min;this.max=this._max;this.tickInterval=this._tickInterval;this.numberTicks=this._numberTicks;this.daTickInterval=this._daTickInterval};$.jqplot.DateAxisRenderer.prototype.createTicks=function(){var ticks=this._ticks;var userTicks=this.ticks;var name=this.name;var db=this._dataBounds;var iv=this._intervalStats;var dim,interval;var min,max;var pos1,pos2;var tt,i;min=((this.min!=null)?new $.jsDate(this.min).getTime():db.min);max=((this.max!=null)?new $.jsDate(this.max).getTime():db.max);var range=max-min;if(userTicks.length){for(i=0;i<userTicks.length;i++){var ut=userTicks[i];var t=new this.tickRenderer(this.tickOptions);if(ut.constructor==Array){t.value=new $.jsDate(ut[0]).getTime();t.label=ut[1];if(!this.showTicks){t.showLabel=false;t.showMark=false}else if(!this.showTickMarks){t.showMark=false}t.setTick(t.value,this.name);this._ticks.push(t)}else{t.value=new $.jsDate(ut).getTime();if(!this.showTicks){t.showLabel=false;t.showMark=false}else if(!this.showTickMarks){t.showMark=false}t.setTick(t.value,this.name);this._ticks.push(t)}}this.numberTicks=userTicks.length;this.min=this._ticks[0].value;this.max=this._ticks[this.numberTicks-1].value;this.daTickInterval=[(this.max-this.min)/(this.numberTicks-1)/1000,'seconds']}else if(this.tickInterval==null&&this.min==null&&this.max==null&&this.numberTicks==null){var ret=$.jqplot.LinearTickGenerator(min,max);var tumin=min+range*(this.padMin-1);var tumax=max-range*(this.padMax-1);if(min<=tumin||max>=tumax){tumin=min-range*(this.padMin-1);tumax=max+range*(this.padMax-1);ret=$.jqplot.LinearTickGenerator(tumin,tumax)}this.min=ret[0];this.max=ret[1];this.numberTicks=ret[2];this.tickInterval=ret[4];this.daTickInterval=[this.tickInterval/1000,'seconds'];for(var i=0;i<this.numberTicks;i++){var min=new $.jsDate(this.min);tt=min.add(i*this.daTickInterval[0],this.daTickInterval[1]).getTime();var t=new this.tickRenderer(this.tickOptions);if(!this.showTicks){t.showLabel=false;t.showMark=false}else if(!this.showTickMarks){t.showMark=false}t.setTick(tt,this.name);this._ticks.push(t)}}else{if(name=='xaxis'||name=='x2axis'){dim=this._plotDimensions.width}else{dim=this._plotDimensions.height}if(this.min!=null&&this.max!=null&&this.numberTicks!=null){this.tickInterval=null}if(this.tickInterval!=null){if(Number(this.tickInterval)){this.daTickInterval=[Number(this.tickInterval),'seconds']}else if(typeof this.tickInterval=="string"){var parts=this.tickInterval.split(' ');if(parts.length==1){this.daTickInterval=[1,parts[0]]}else if(parts.length==2){this.daTickInterval=[parts[0],parts[1]]}}}if(min==max){var adj=24*60*60*500;min-=adj;max+=adj}range=max-min;var optNumTicks=2+parseInt(Math.max(0,dim-100)/100,10);var rmin,rmax;rmin=(this.min!=null)?new $.jsDate(this.min).getTime():min-range/2*(this.padMin-1);rmax=(this.max!=null)?new $.jsDate(this.max).getTime():max+range/2*(this.padMax-1);this.min=rmin;this.max=rmax;range=this.max-this.min;if(this.numberTicks==null){if(this.daTickInterval!=null){var nc=new $.jsDate(this.max).diff(this.min,this.daTickInterval[1],true);this.numberTicks=Math.ceil(nc/this.daTickInterval[0])+1;this.max=new $.jsDate(this.min).add((this.numberTicks-1)*this.daTickInterval[0],this.daTickInterval[1]).getTime()}else if(dim>200){this.numberTicks=parseInt(3+(dim-200)/100,10)}else{this.numberTicks=2}}if(this.daTickInterval==null){this.daTickInterval=[range/(this.numberTicks-1)/1000,'seconds']}for(var i=0;i<this.numberTicks;i++){var min=new $.jsDate(this.min);tt=min.add(i*this.daTickInterval[0],this.daTickInterval[1]).getTime();var t=new this.tickRenderer(this.tickOptions);if(!this.showTicks){t.showLabel=false;t.showMark=false}else if(!this.showTickMarks){t.showMark=false}t.setTick(tt,this.name);this._ticks.push(t)}}if(this._daTickInterval==null){this._daTickInterval=this.daTickInterval}}})(jQuery);